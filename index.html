<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Iglesia - PWA Publicaciones</title>
  <link rel="manifest" href="manifest.json" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="icon" href="icon.png" />
  <style>
    body {
      font-family: system-ui, sans-serif;
      background-color: #f3f4f6;
    }
    .section-hidden {
      display: none;
    }
    .section-active {
      display: block;
    }
    .nav-btn.active svg,
    .nav-btn.active span {
      color: #4f46e5;
      font-weight: 600;
    }
  </style>
</head>

<body class="flex flex-col min-h-screen">
  <main class="flex-1 p-4">
    <!-- 🏠 Sección principal -->
    <div id="section-inicio" class="section-active bg-white p-4 rounded-xl shadow-md text-center">
      <h1 class="text-xl font-semibold mb-2">Bienvenido 🙌</h1>
      <p class="text-gray-600">Explora las publicaciones más recientes de la iglesia.</p>
    </div>

    <!-- 📰 Sección de Publicaciones -->
    <div id="section-publicaciones" class="section-hidden bg-white p-4 rounded-xl shadow-md">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-lg font-semibold">📰 Publicaciones</h2>
        <button onclick="cargarPublicaciones()" class="text-sm text-indigo-600 font-medium hover:underline flex items-center gap-1">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v6h6M20 20v-6h-6M4 20l16-16"/>
          </svg>
          Actualizar
        </button>
      </div>
      <div id="lista-publicaciones" class="space-y-3 text-gray-700 text-sm">
        <p class="text-center text-gray-400">Cargando publicaciones...</p>
      </div>
    </div>
  </main>

  <!-- 📱 Barra de navegación inferior -->
  <nav class="bg-white shadow-inner flex justify-around p-2 border-t">
    <button class="nav-btn flex flex-col items-center active" data-section="inicio">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l9-9 9 9M4 10v10a1 1 0 001 1h6m8-11v10a1 1 0 01-1 1h-6"/>
      </svg>
      <span class="text-xs">Inicio</span>
    </button>

    <button class="nav-btn flex flex-col items-center" data-section="publicaciones">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a7 7 0 11-14 0 7 7 0 0114 0z" />
      </svg>
      <span class="text-xs">Publicaciones</span>
    </button>
  </nav>

  <!-- 📦 PapaParse -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <script>
  const URL_SHEET = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSyHmU-0ZwmCIFmwaaiC8FLVhSU4n6GNBh4JGtlgf89LWG-4wVW_7Awh8ICilQi5xd5qDVEnfyC2i2O/pub?output=csv";

  // 🔹 Cambiar entre secciones
  document.querySelectorAll(".nav-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      document.querySelectorAll(".nav-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      const sectionId = "section-" + btn.dataset.section;
      document.querySelectorAll("main > div").forEach(div => div.classList.add("section-hidden"));
      document.getElementById(sectionId).classList.remove("section-hidden");
      document.getElementById(sectionId).classList.add("section-active");
    });
  });

  // 🔹 Detectar si el enlace es imagen
  function esImagen(url) {
    return /\.(jpg|jpeg|png|gif|webp)(\?.*)?$/i.test(url);
  }

  // 🔹 Convertir cualquier formato de YouTube a embed
  function convertirEnlaceYouTube(url) {
    if (!url) return null;
    url = url.trim();
    let m = url.match(/youtube\.com\/embed\/([a-zA-Z0-9_-]+)/i);
    if (m) return `https://www.youtube.com/embed/${m[1]}`;
    m = url.match(/[?&]v=([a-zA-Z0-9_-]{11})/i);
    if (m) return `https://www.youtube.com/embed/${m[1]}`;
    m = url.match(/youtu\.be\/([a-zA-Z0-9_-]{11})/i);
    if (m) return `https://www.youtube.com/embed/${m[1]}`;
    m = url.match(/youtube\.com\/shorts\/([a-zA-Z0-9_-]+)/i);
    if (m) return `https://www.youtube.com/embed/${m[1]}`;
    m = url.match(/([a-zA-Z0-9_-]{11})$/);
    if (m) return `https://www.youtube.com/embed/${m[1]}`;
    return null;
  }

  // 🔹 Cargar publicaciones desde Google Sheets
  async function cargarPublicaciones() {
    const contenedor = document.getElementById("lista-publicaciones");
    contenedor.innerHTML = "<p class='text-center text-gray-400'>Cargando publicaciones...</p>";

    try {
      const response = await fetch(URL_SHEET);
      if (!response.ok) throw new Error("No se pudo acceder a la hoja");

      const csvText = await response.text();
      const data = Papa.parse(csvText, { header: true, skipEmptyLines: true }).data;
      contenedor.innerHTML = "";

      if (!data || data.length === 0) {
        contenedor.innerHTML = "<p class='text-center text-gray-400'>No hay publicaciones todavía.</p>";
        return;
      }

data.forEach(row => {
  const card = document.createElement("div");
  card.className = "bg-white rounded-lg shadow-md p-4 mb-4";

  // Título
  const title = document.createElement("h2");
  title.className = "text-lg font-bold mb-2";
  title.textContent = row["titulo"] || "";
  card.appendChild(title);

  // Contenido
  const content = document.createElement("p");
  content.className = "text-gray-700 mb-2";
  content.textContent = row["contenido"] || "";
  card.appendChild(content);

  // Imagen (si existe)
  if (row["imagen"]) {
    const image = document.createElement("img");
    image.src = row["imagen"];
    image.alt = "Imagen de publicación";
    image.className = "w-full h-52 object-cover rounded-lg shadow mb-2";
    card.appendChild(image);
  }

  // Video (si existe)
  if (row["video"]) {
    const video = document.createElement("iframe");
    video.src = row["video"];
    video.className = "w-full h-52 rounded-lg shadow mb-2";
    video.title = "Video de publicación";
    video.frameBorder = "0";
    video.allowFullscreen = true;
    card.appendChild(video);
  }

  // Fecha
  const date = document.createElement("p");
  date.className = "text-gray-500 text-sm";
  date.textContent = row["fecha"] || "";
  card.appendChild(date);

  container.appendChild(card);
});
  </script>
</body>
</html>
