<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Novedades y Eventos</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; background:#f9f9f9;}
  h2 { margin-top:40px; color:#333; }
  .grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap:15px;}
  .card { background:#fff; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1); padding:15px; cursor:pointer; transition: all 0.3s ease; overflow:hidden; max-height:250px; position:relative; }
  .card.expanded { max-height:1000px; }
  .card img, .card iframe { border-radius:10px; margin-bottom:10px; }
  .card h3 { font-size:1.1em; margin-bottom:5px; }
  .share-btn { background:#1da1f2; color:#fff; border:none; border-radius:5px; padding:5px 10px; cursor:pointer; font-size:0.9em; }
</style>
</head>
<body>

<h2>Novedades</h2>
<div id="lista-publicaciones" class="grid"></div>

<h2>Eventos</h2>
<div id="eventContainer" class="grid"></div>

<script>
const URL_SHEET = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSyHmU-0ZwmCIFmwaaiC8FLVhSU4n6GNBh4JGtlgf89LWG-4wVW_7Awh8ICilQi5xd5qDVEnfyC2i2O/pub?output=csv";

async function cargarDatos() {
  const contNovedades = document.getElementById("lista-publicaciones");
  const contEventos = document.getElementById("eventContainer");
  contNovedades.innerHTML = "Cargando...";
  contEventos.innerHTML = "Cargando...";

  try {
    const resp = await fetch(URL_SHEET);
    if (!resp.ok) throw new Error("No se pudo acceder a la hoja");
    const csvText = await resp.text();
    const parsed = Papa.parse(csvText, { header: true, skipEmptyLines: true });

    contNovedades.innerHTML = "";
    contEventos.innerHTML = "";

    parsed.data.reverse().forEach(raw => {
      const row = {};
      Object.keys(raw).forEach(k => row[k.trim().toLowerCase()] = String(raw[k] || "").trim());

      const titulo = row.titulo || "Sin tÃ­tulo";
      const contenido = row.contenido || "";
      const imagen = row.imagen || "";
      const video = row.video || "";
      const spotify = row.spotify || "";
      const tipo = row.tipo?.toLowerCase() || "novedad";

      const card = document.createElement("div");
      card.className = "card";

      let html = `<h3>${titulo}</h3>`;
      if (imagen) html += `<img src="${imagen}" alt="${titulo}" />`;
      if (video) html += `<iframe width="100%" height="200" src="${video}" frameborder="0" allowfullscreen></iframe>`;
      if (spotify) html += `<iframe src="${spotify}" width="100%" height="80" frameborder="0" allow="encrypted-media"></iframe>`;
      html += `<p>${contenido}</p>`;
      html += `<div><button class="share-btn">ðŸ”— Compartir</button></div>`;

      card.innerHTML = html;

      // Expandir tarjeta
      card.addEventListener("click", (e) => {
        if (!e.target.classList.contains("share-btn")) {
          card.classList.toggle("expanded");
        }
      });

      // Compartir
      card.querySelector(".share-btn").addEventListener("click", (e) => {
        e.stopPropagation();
        if (navigator.share) {
          navigator.share({ title: titulo, text: contenido, url: window.location.href });
        } else {
          alert("Tu navegador no soporta compartir");
        }
      });

      if (tipo === "evento") {
        contEventos.appendChild(card);
      } else {
        contNovedades.appendChild(card);
      }
    });

    if (!contEventos.hasChildNodes()) contEventos.innerHTML = "<p>No hay eventos disponibles.</p>";
    if (!contNovedades.hasChildNodes()) contNovedades.innerHTML = "<p>No hay novedades disponibles.</p>";

  } catch (e) {
    console.error(e);
    contNovedades.innerHTML = "Error al cargar novedades";
    contEventos.innerHTML = "Error al cargar eventos";
  }
}

document.addEventListener("DOMContentLoaded", cargarDatos);
</script>

</body>
</html>
