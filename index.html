<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Soy IBA</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #fafafa;
    }

    /* Gradiente tipo Instagram */
    .insta-gradient {
      background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
    }

    /* Modal visible */
    .story-active {
      display: flex !important;
    }

    /* Animaci√≥n fade */
    .fade {
      animation: fadein 0.5s;
    }

    @keyframes fadein {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    /* Barra de progreso */
    .progress-bar {
      transition: width 1s linear;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

</head>
<body class="text-gray-800">

  <!-- RIBBON SUPERIOR -->
  <header class="flex items-center justify-between p-4 bg-white shadow">
    <h1 class="text-2xl font-bold text-pink-600">Soy IBA</h1>
    <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-gray-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h16M4 16h16" />
    </svg>
  </header>

  <!-- EVENTOS -->
  <section class="p-3 overflow-x-auto flex gap-4">
    <div class="flex gap-4">
      <div class="flex-shrink-0 text-center cursor-pointer" onclick="openStory(0)">
        <div class="p-[2px] rounded-full insta-gradient">
          <img src="https://images.unsplash.com/photo-1497032628192-86f99bcd76bc?w=200" class="w-20 h-20 rounded-full object-cover border-2 border-white">
        </div>
        <p class="text-xs mt-1">Concierto </p>
      </div>

      <div class="flex-shrink-0 text-center cursor-pointer" onclick="openStory(1)">
        <div class="p-[2px] rounded-full insta-gradient">
          <img src="https://images.unsplash.com/photo-1551836022-4c4c79ecde51?w=200" class="w-20 h-20 rounded-full object-cover border-2 border-white">
        </div>
        <p class="text-xs mt-1">Reuni√≥n</p>
      </div>

      <div class="flex-shrink-0 text-center cursor-pointer" onclick="openStory(2)">
        <div class="p-[2px] rounded-full insta-gradient">
          <img src="https://images.unsplash.com/photo-1535930749574-1399327ce78f?w=200" class="w-20 h-20 rounded-full object-cover border-2 border-white">
        </div>
        <p class="text-xs mt-1">Domingo</p>
      </div>
    </div>
  </section>
  <!--Novedades de sheet-->
<section id="novedades" class="p-4 space-y-6"></section>

  <!-- NOVEDADES -->
  <section class="p-4 space-y-6">
    <div class="bg-white rounded-2xl shadow">
      <img src="https://images.unsplash.com/photo-1497493292307-31c376b6e479?w=800" class="w-full h-64 object-cover rounded-t-2xl">
      <div class="p-3">
        <h2 class="font-semibold text-lg">Transmisi√≥n en vivo üé•</h2>
        <p class="text-gray-600 text-sm mt-1">Disfruta del mensaje del domingo a las 10 AM.</p>
        <div class="flex justify-between items-center mt-3">
          <span class="text-xs text-gray-400">Publicado: 9 oct 2025</span>
          <button class="text-pink-600 text-sm" onclick="sharePost('Transmisi√≥n en vivo')">Compartir</button>
        </div>
      </div>
    </div>

    <div class="bg-white rounded-2xl shadow">
      <img src="https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=800" class="w-full h-64 object-cover rounded-t-2xl">
      <div class="p-3">
        <h2 class="font-semibold text-lg">Noche de Alabanza ‚ú®</h2>
        <p class="text-gray-600 text-sm mt-1">√önete a nosotros para una noche de adoraci√≥n y m√∫sica.</p>
        <div class="flex justify-between items-center mt-3">
          <span class="text-xs text-gray-400">Publicado: 7 oct 2025</span>
          <button class="text-pink-600 text-sm" onclick="sharePost('Noche de Alabanza')">Compartir</button>
        </div>
      </div>
    </div>
  </section>

  <!-- STORY MODAL -->
  <div id="storyModal" class="hidden fixed inset-0 bg-black bg-opacity-90 justify-center items-center z-50">
    <!-- X SIEMPRE VISIBLE -->
    <button onclick="closeStory()" class="absolute top-4 right-4 text-white text-3xl font-bold z-50">√ó</button>

    <!-- Barra de progreso y contador -->
    <div class="absolute top-0 left-0 w-full px-6 pt-5 z-40">
      <div class="h-1 bg-gray-500 rounded-full overflow-hidden">
        <div id="progressBar" class="h-1 bg-pink-500 progress-bar" style="width:0%"></div>
      </div>
      <p id="countdown" class="text-white text-sm mt-1 text-right">5s</p>
    </div>

    <div class="relative w-full h-full flex items-center justify-center">
      <div id="storyContent" class="relative w-full h-full flex items-center justify-center fade">
        <img id="storyImage" src="" class="object-cover w-full h-full">
        <div class="absolute bottom-0 w-full bg-gradient-to-t from-black/80 to-transparent p-6 text-white">
          <h2 id="storyTitle" class="text-xl font-bold"></h2>
          <p id="storyDesc" class="text-sm"></p>
          <button id="shareBtn" onclick="shareStory()" class="absolute bottom-6 right-6 text-white bg-pink-500 rounded-full p-2 text-xs">üîó</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const stories = [
      {
        img: "https://images.unsplash.com/photo-1497032628192-86f99bcd76bc?w=1080",
        title: "Concierto de Fe",
        desc: "Una noche llena de m√∫sica y esperanza."
      },
      {
        img: "https://images.unsplash.com/photo-1551836022-4c4c79ecde51?w=1080",
        title: "Reuni√≥n de l√≠deres",
        desc: "Creciendo juntos en prop√≥sito."
      },
      {
        img: "https://images.unsplash.com/photo-1535930749574-1399327ce78f?w=1080",
        title: "Domingo de adoraci√≥n",
        desc: "Ven y comparte con nosotros."
      }
    ];

    let currentStory = 0;
    let autoAdvance;
    let countdownInterval;
    const duration = 5; // segundos
    let remaining = duration;

    function showStory(index) {
      currentStory = index;
      const story = stories[index];
      document.getElementById("storyImage").src = story.img;
      document.getElementById("storyTitle").innerText = story.title;
      document.getElementById("storyDesc").innerText = story.desc;
      resetProgress();
    }

    function openStory(index) {
      const modal = document.getElementById("storyModal");
      modal.classList.remove("hidden");
      modal.classList.add("flex");
      showStory(index);
      startAutoAdvance();
    }

    function closeStory() {
      const modal = document.getElementById("storyModal");
      modal.classList.add("hidden");
      modal.classList.remove("flex");
      clearInterval(autoAdvance);
      clearInterval(countdownInterval);
      resetProgress(true);
    }

    function nextStory() {
      currentStory = (currentStory + 1) % stories.length;
      showStory(currentStory);
    }

    function startAutoAdvance() {
      clearInterval(autoAdvance);
      clearInterval(countdownInterval);
      remaining = duration;
      updateCountdown();

      countdownInterval = setInterval(() => {
        remaining--;
        updateCountdown();
        if (remaining <= 0) {
          nextStory();
        }
      }, 1000);

      let progress = 0;
      const progressBar = document.getElementById("progressBar");
      progressBar.style.width = "0%";

      autoAdvance = setInterval(() => {
        progress += 20; // cada segundo equivale al 20%
        progressBar.style.width = progress + "%";
        if (progress >= 100) {
          progress = 0;
          progressBar.style.width = "0%";
        }
      }, 1000);
    }

    function resetProgress(clear = false) {
      const progressBar = document.getElementById("progressBar");
      progressBar.style.width = clear ? "0%" : "100%";
      remaining = duration;
      updateCountdown();
    }

    function updateCountdown() {
      document.getElementById("countdown").innerText = remaining + "s";
    }

    function shareStory() {
      const story = stories[currentStory];
      if (navigator.share) {
        navigator.share({
          title: story.title,
          text: story.desc,
          url: window.location.href
        });
      } else {
        alert("Tu navegador no soporta compartir.");
      }
    }

    function sharePost(title) {
      if (navigator.share) {
        navigator.share({
          title: title,
          url: window.location.href
        });
      } else {
        alert("Tu navegador no soporta compartir.");
      }
    }

    

    
  </script>

<script>
const URL_SHEET = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSyHmU-0ZwmCIFmwaaiC8FLVhSU4n6GNBh4JGtlgf89LWG-4wVW_7Awh8ICilQi5xd5qDVEnfyC2i2O/pub?output=csv";

// --- Funciones auxiliares multimedia ---
function esImagen(url) {
  return !!url && /\.(jpg|jpeg|png|gif|webp)(\?.*)?$/i.test(url);
}

function convertirEnlaceYouTube(url) {
  if (!url) return null;
  url = String(url).trim();
  let m = url.match(/youtube\.com\/embed\/([a-zA-Z0-9_-]+)/i);
  if (m) return `https://www.youtube.com/embed/${m[1]}`;
  m = url.match(/[?&]v=([a-zA-Z0-9_-]{11})/i);
  if (m) return `https://www.youtube.com/embed/${m[1]}`;
  m = url.match(/youtu\.be\/([a-zA-Z0-9_-]{11})/i);
  if (m) return `https://www.youtube.com/embed/${m[1]}`;
  m = url.match(/youtube\.com\/shorts\/([a-zA-Z0-9_-]+)/i);
  if (m) return `https://www.youtube.com/embed/${m[1]}`;
  return null;
}

function convertirSpotifyEnEmbed(url) {
  if (!url) return null;
  url = url.split("?")[0];
  url = url.replace("/intl-es", "");
  const match = url.match(/open\.spotify\.com\/(track|album|playlist)\/([a-zA-Z0-9]+)/);
  if (match) return `https://open.spotify.com/embed/${match[1]}/${match[2]}`;
  if (url.includes("embed")) return url;
  return null;
}

// --- Cargar novedades desde la Sheet ---
async function cargarNovedades() {
  const contenedor = document.getElementById("novedades");
  if (!contenedor) return;
  contenedor.innerHTML = "<p class='text-center text-gray-400'>Cargando novedades...</p>";

  try {
    const response = await fetch(URL_SHEET);
    const csvText = await response.text();
    const data = Papa.parse(csvText, { header: true, skipEmptyLines: true }).data;

    contenedor.innerHTML = "";

    // Ordenar por fecha (m√°s recientes primero)
    data.sort((a, b) => new Date(b.Fecha) - new Date(a.Fecha));

    data.forEach(row => {
      const titulo = row.Titulo?.trim() || "Sin t√≠tulo";
      const contenido = row.Contenido?.trim() || "";
      const imagen = row.Imagen?.trim() || "";
      const video = row.Video?.trim() || "";
      const spotify = row.Spotify?.trim() || "";
      const fecha = row.Fecha?.trim() || "";

      // Crear card base
      const card = document.createElement("div");
      card.className = "bg-white rounded-2xl shadow border border-gray-200 overflow-hidden";

      // Determinar contenido multimedia
      let multimediaHTML = "";
      if (esImagen(imagen)) {
        multimediaHTML = `<img src="${imagen}" class="w-full h-64 object-cover rounded-t-2xl">`;
      } else if (convertirEnlaceYouTube(video)) {
        multimediaHTML = `
          <iframe class="w-full h-64 rounded-t-2xl"
            src="${convertirEnlaceYouTube(video)}"
            frameborder="0"
            allowfullscreen></iframe>`;
      } else if (convertirSpotifyEnEmbed(spotify)) {
        multimediaHTML = `
          <iframe class="w-full h-20 rounded-t-2xl"
            src="${convertirSpotifyEnEmbed(spotify)}"
            frameborder="0"
            allowtransparency="true"
            allow="encrypted-media"></iframe>`;
      }

      // Armar contenido HTML
      card.innerHTML = `
        ${multimediaHTML}
        <div class="p-3">
          <h2 class="font-semibold text-lg">${titulo}</h2>
          <p class="text-gray-600 text-sm mt-1">${contenido}</p>
          <div class="flex justify-between items-center mt-3">
            <span class="text-xs text-gray-400">Publicado: ${fecha}</span>
            <button class="text-pink-600 text-sm" onclick="sharePost('${titulo}')">Compartir</button>
          </div>
        </div>
      `;

      contenedor.appendChild(card);
    });
  } catch (err) {
    console.error("Error al cargar la hoja:", err);
    contenedor.innerHTML = "<p class='text-center text-red-500'>Error al cargar novedades.</p>";
  }
}

// --- Funci√≥n de compartir ---
function sharePost(titulo) {
  if (navigator.share) {
    navigator.share({
      title: titulo,
      text: "Mira esta novedad:",
      url: window.location.href
    });
  } else {
    alert("Tu navegador no soporta la funci√≥n de compartir");
  }
}

document.addEventListener("DOMContentLoaded", cargarNovedades);
</script>
</body>
</html>



