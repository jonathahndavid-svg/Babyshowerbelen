<!doctype html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Soy IBA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="icon.png" />
    <style>
        html,
        body {
            height: 100%;
            margin: 0;
            background:
                radial-gradient(circle at 20% 20%, #e5d9f2, transparent 30%),
                radial-gradient(circle at 80% 25%, #d0e1fa, transparent 30%),
                radial-gradient(circle at 40% 80%, #c8f6f9, transparent 30%),
                radial-gradient(circle at 70% 90%, #ffe6e6, transparent 30%),
                #f3f7fb;
            background-attachment: fixed;
            display: flex;
            flex-direction: column;
            color: rgb(100, 109, 174);
        }

        /* Smooth entry animation */
        .section-hidden {
            opacity: 0;
            transform: translateX(50px);
            position: absolute;
            width: 100%;
            transition: opacity 0.5s ease, transform 0.5s ease;
        }

        .section-active {
            opacity: 1;
            transform: translateX(0);
            position: relative;
            transition: opacity 0.5s ease, transform 0.5s ease;
        }

        /* Scroll horizontal for events */
        #eventos-scroll {
            display: flex;
            overflow-x: auto;
            gap: 1rem;
            padding-bottom: 0.5rem;
        }

        #eventos-scroll::-webkit-scrollbar {
            height: 8px;
        }

        #eventos-scroll::-webkit-scrollbar-thumb {
            background: #a5b4fc;
            border-radius: 4px;
        }

        /* Card hover zoom */
        .card-hover:hover {
            transform: scale(1.03);
            transition: transform 0.3s ease;
        }
    </style>
</head>

<body class="flex flex-col h-screen">

    <!-- Header / Rib√≥n -->
    <header class="flex items-center justify-between p-4 bg-white shadow-md">
        <div class="flex items-center space-x-2">
            <img src="https://i.imgur.com/0y0y0y0.png" alt="Logo" class="h-10 w-10 rounded-full object-cover" />
            <span class="font-bold text-xl text-indigo-600">Soy IBA</span>
        </div>
        <button id="menuBtn" class="p-2 rounded hover:bg-indigo-100 text-2xl">‚ò∞</button>
    </header>

    <!-- Sidebar -->
    <aside id="sidebar"
        class="fixed top-0 right-0 h-full w-64 bg-white shadow-lg transform translate-x-full transition-transform duration-300 z-50 overflow-y-auto">
        <div class="flex justify-end p-2">
            <button id="closeSidebar" class="p-2 text-gray-600 hover:text-red-500">‚úï</button>
        </div>
        <div class="p-4 space-y-4">
            <h2 class="text-lg font-bold">Misi√≥n</h2>
            <p>Proclamar el evangelio y discipular con amor.</p>
            <h2 class="text-lg font-bold">Visi√≥n</h2>
            <p>Ser una iglesia centrada en Cristo.</p>
            <h2 class="text-lg font-bold">Lo que creemos</h2>
            <p>Basados en la Biblia como Palabra de Dios.</p>
            <h2 class="text-lg font-bold">Horarios</h2>
            <ul class="list-disc pl-5">
                <li>Domingo 8:00 y 10:00 AM</li>
                <li>Jueves 08:00 AM Ayuno / 07:00 PM Estudio b√≠blico</li>
                <li>S√°bado 04:00 PM Pre Juveniles / 06:00 PM J√≥venes</li>
                <li>√öltimo martes 07:00 PM Oraci√≥n</li>
            </ul>
            <h2 class="text-lg font-bold">Contacto</h2>
            <p>Calle 38asur #38-34, Envigado<br>info@iglesiaiba.org</p>
        </div>
    </aside>

    <!-- Contenido principal -->
    <main id="content" class="flex-1 overflow-y-auto p-4 pb-20 relative space-y-6">

        <!-- Pr√≥ximos Eventos -->
        <section id="proximos-eventos" class="section-active bg-white p-4 rounded-xl shadow-md">
            <h2 class="text-lg font-semibold mb-2 text-center">üìÖ Pr√≥ximos Eventos</h2>
            <div id="eventos-scroll">
                <!-- Tarjetas de ejemplo -->
                <div class="min-w-[150px] bg-indigo-50 rounded-xl shadow-sm p-2 card-hover cursor-pointer">
                    <img src="https://i.imgur.com/8Km9tLL.jpg" alt="Evento 1" class="rounded-xl w-full h-24 object-cover" />
                    <p class="text-center font-semibold mt-1">01 Oct</p>
                    <p class="text-center text-sm">Concierto</p>
                </div>
                <div class="min-w-[150px] bg-indigo-50 rounded-xl shadow-sm p-2 card-hover cursor-pointer">
                    <img src="https://i.imgur.com/Z5Qxq3S.jpg" alt="Evento 2" class="rounded-xl w-full h-24 object-cover" />
                    <p class="text-center font-semibold mt-1">05 Oct</p>
                    <p class="text-center text-sm">Retiro</p>
                </div>
                <div class="min-w-[150px] bg-indigo-50 rounded-xl shadow-sm p-2 card-hover cursor-pointer">
                    <img src="https://i.imgur.com/3JfMZ0x.jpg" alt="Evento 3" class="rounded-xl w-full h-24 object-cover" />
                    <p class="text-center font-semibold mt-1">10 Oct</p>
                    <p class="text-center text-sm">Seminario</p>
                </div>
                <div class="min-w-[150px] bg-indigo-50 rounded-xl shadow-sm p-2 card-hover cursor-pointer">
                    <img src="https://i.imgur.com/jf5dXqF.jpg" alt="Evento 4" class="rounded-xl w-full h-24 object-cover" />
                    <p class="text-center font-semibold mt-1">12 Oct</p>
                    <p class="text-center text-sm">Campamento</p>
                </div>
                <div class="min-w-[150px] bg-indigo-50 rounded-xl shadow-sm p-2 card-hover cursor-pointer">
                    <img src="https://i.imgur.com/B1z2F4P.jpg" alt="Evento 5" class="rounded-xl w-full h-24 object-cover" />
                    <p class="text-center font-semibold mt-1">15 Oct</p>
                    <p class="text-center text-sm">Encuentro Juvenil</p>
                </div>
            </div>
        </section>

        <!-- Novedades estilo Instagram -->
        <section id="novedades" class="section-active bg-white p-4 rounded-xl shadow-md">
            <h2 class="text-lg font-semibold mb-4 text-center">‚ú® Novedades</h2>
            <div id="lista-publicaciones" class="flex flex-col gap-4 text-gray-700">
                <p class="text-center text-gray-400">Cargando novedades...</p>
            </div>
        </section>

    </main>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <script>
        // Sidebar
        const menuBtn = document.getElementById("menuBtn");
        const sidebar = document.getElementById("sidebar");
        const closeSidebar = document.getElementById("closeSidebar");
        menuBtn.addEventListener("click", () => { sidebar.classList.toggle("translate-x-full"); });
        closeSidebar.addEventListener("click", () => { sidebar.classList.add("translate-x-full"); });

        // Funciones utilitarias
        const URL_SHEET = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSyHmU-0ZwmCIFmwaaiC8FLVhSU4n6GNBh4JGtlgf89LWG-4wVW_7Awh8ICilQi5xd5qDVEnfyC2i2O/pub?output=csv";
        function esImagen(url) { return !!url && /\.(jpg|jpeg|png|gif|webp)(\?.*)?$/i.test(url); }
        function convertirEnlaceYouTube(url) {
            if (!url) return null;
            url = String(url).trim();
            let m = url.match(/youtube\.com\/embed\/([a-zA-Z0-9_-]+)/i);
            if (m) return `https://www.youtube.com/embed/${m[1]}`;
            m = url.match(/[?&]v=([a-zA-Z0-9_-]{11})/i);
            if (m) return `https://www.youtube.com/embed/${m[1]}`;
            m = url.match(/youtu\.be\/([a-zA-Z0-9_-]{11})/i);
            if (m) return `https://www.youtube.com/embed/${m[1]}`;
            m = url.match(/youtube\.com\/shorts\/([a-zA-Z0-9_-]+)/i);
            if (m) return `https://www.youtube.com/embed/${m[1]}`;
            return null;
        }
        function convertirSpotifyEnEmbed(url) {
            if (!url) return null;
            url = url.split("?")[0].replace("/intl-es", "");
            const match = url.match(/open\.spotify\.com\/(track|album|playlist)\/([a-zA-Z0-9]+)/);
            if (match) return `https://open.spotify.com/embed/${match[1]}/${match[2]}`;
            if (url.includes("embed")) return url;
            return null;
        }

        async function cargarPublicaciones() {
            const contenedor = document.getElementById("lista-publicaciones");
            if (!contenedor) return;
            contenedor.innerHTML = "<p class='text-center text-gray-400'>Cargando publicaciones...</p>";

            try {
                const response = await fetch(URL_SHEET);
                if (!response.ok) throw new Error("No se pudo acceder a la hoja");

                const csvText = await response.text();
                const parsed = Papa.parse(csvText, { header: true, skipEmptyLines: true }).data;
                contenedor.innerHTML = "";
                if (!parsed || parsed.length === 0) {
                    contenedor.innerHTML = "<p class='text-center text-gray-400'>No hay publicaciones todav√≠a.</p>";
                    return;
                }

                parsed.reverse().forEach(rawRow => {
                    const row = {};
                    Object.keys(rawRow).forEach(k => {
                        const key = k ? k.trim().toLowerCase() : "";
                        row[key] = rawRow[k] ? String(rawRow[k]).trim() : "";
                    });
                    if (!row.titulo && !row.contenido) return;

                    const card = document.createElement("div");
                    card.className = "bg-white border border-gray-200 rounded-xl shadow-sm p-4 flex flex-col gap-2 card-hover";

                    // Header con perfil
                    const header = document.createElement("div");
                    header.className = "flex items-center gap-2";
                    const perfil = document.createElement("img");
                    perfil.src = row.foto || "https://i.imgur.com/0y0y0y0.png";
                    perfil.alt = "Perfil";
                    perfil.className = "w-10 h-10 rounded-full object-cover";
                    const nombre = document.createElement("div");
                    nombre.innerHTML = `<p class="font-semibold text-indigo-600 text-sm">${row.nombre || "Soy IBA"}</p>
                                        <p class="text-xs text-gray-400">${row.fecha || ""}</p>`;
                    header.appendChild(perfil);
                    header.appendChild(nombre);
                    card.appendChild(header);

                    // Titulo
                    if (row.titulo) {
                        const t = document.createElement("h3");
                        t.className = "font-semibold text-base mt-2";
                        t.textContent = row.titulo;
                        card.appendChild(t);
                    }

                    // Contenido
                    if (row.contenido) {
                        const c = document.createElement("p");
                        c.className = "text-sm text-gray-700 whitespace-pre-line";
                        c.textContent = row.contenido;
                        card.appendChild(c);
                    }

                    // Imagen
                    if (row.imagen && esImagen(row.imagen)) {
                        const img = document.createElement("img");
                        img.src = row.imagen;
                        img.alt = row.titulo || "Imagen";
                        img.className = "w-full rounded-xl mt-2 cursor-pointer";
                        img.addEventListener("click", () => window.open(row.imagen, "_blank"));
                        card.appendChild(img);
                    }

                    // Compartir
                    const shareBtn = document.createElement("button");
                    shareBtn.className = "mt-2 px-3 py-1 bg-green-500 text-white rounded-lg hover:bg-green-600 text-sm flex items-center justify-center gap-1";
                    shareBtn.textContent = "üì§ Compartir";
                    shareBtn.addEventListener("click", () => {
                        let mensaje = `*${row.titulo || "Sin t√≠tulo"}*\n\n`;
                        if (row.contenido) mensaje += `${row.contenido}\n\n`;
                        if (row.imagen) mensaje += `Imagen: ${row.imagen}\n`;
                        mensaje += `\n_Compartido desde SoyIBA_`;
                        const url = "https://api.whatsapp.com/send?text=" + encodeURIComponent(mensaje);
                        window.open(url, "_blank");
                    });
                    card.appendChild(shareBtn);

                    contenedor.appendChild(card);
                });

            } catch (err) {
                console.error(err);
                contenedor.innerHTML = "<p class='text-center text-red-500'>Error al cargar publicaciones.</p>";
            }
        }

        document.addEventListener("DOMContentLoaded", cargarPublicaciones);
    </script>

</body>

</html>

