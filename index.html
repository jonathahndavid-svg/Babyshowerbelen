<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Soy IBA - Novedades</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="icon" href="icon.png" />
<style>
body { background: #f3f7fb; font-family: sans-serif; margin:0; }
.section-hidden { display:none; opacity:0; transform:translateX(50px); transition:0.5s;}
.section-active { display:block; opacity:1; transform:translateX(0); transition:0.5s;}
#lista-publicaciones>div { max-width:500px; margin:auto; }
</style>
</head>
<body class="bg-gray-50">

<!-- Header -->
<header class="sticky top-0 bg-white/80 backdrop-blur-md border-b border-gray-200 p-4 flex justify-between items-center shadow-sm z-50">
  <div class="flex items-center gap-2">
    <img src="https://i.imgur.com/41xX3kW.png" class="w-8 h-8 rounded-full" alt="logo">
    <h1 class="text-lg font-bold">Soy IBA</h1>
  </div>
  <button id="menuBtn" class="p-2 rounded-full hover:bg-gray-100">â˜°</button>
</header>

<!-- Sidebar -->
<aside id="sidebar" class="fixed top-0 right-0 h-full w-64 bg-white shadow-lg transform translate-x-full transition-transform duration-300 z-50 overflow-y-auto p-4">
  <button id="closeSidebar" class="p-2 text-gray-600 hover:text-red-500 mb-4">âœ•</button>
  <p>MisiÃ³n, VisiÃ³n, Horarios, Contacto...</p>
</aside>

<!-- Eventos prÃ³ximos -->
<section class="px-4 mt-4">
  <h2 class="text-lg font-semibold mb-2">ðŸ“… PrÃ³ximos eventos</h2>
  <div class="flex overflow-x-auto gap-3 pb-2 no-scrollbar" id="eventContainer">
    <!-- Eventos estÃ¡ticos de ejemplo -->
    <div onclick="alert('Detalle Evento')" class="cursor-pointer min-w-[160px] bg-white rounded-xl p-3 shadow border border-gray-200 flex-shrink-0 hover:scale-105 transition">
      <img src="https://i.imgur.com/BVnLydp.jpeg" class="w-full h-20 rounded-lg object-cover mb-2">
      <span class="text-xs font-bold text-blue-600">10 OCT</span>
      <span class="text-sm font-medium block">Encuentro Juvenil</span>
    </div>
  </div>
</section>

<!-- Novedades dinÃ¡micas -->
<main class="p-4 space-y-6 mt-4">
  <h2 class="text-lg font-bold mb-4">âœ¨ Novedades</h2>
  <div id="lista-publicaciones">
    <p class="text-center text-gray-400">Cargando novedades...</p>
  </div>
</main>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script>
const menuBtn = document.getElementById("menuBtn");
const sidebar = document.getElementById("sidebar");
const closeSidebar = document.getElementById("closeSidebar");
menuBtn.addEventListener("click",()=>sidebar.classList.toggle("translate-x-full"));
closeSidebar.addEventListener("click",()=>sidebar.classList.add("translate-x-full"));

const URL_SHEET = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSyHmU-0ZwmCIFmwaaiC8FLVhSU4n6GNBh4JGtlgf89LWG-4wVW_7Awh8ICilQi5xd5qDVEnfyC2i2O/pub?output=csv";

function esImagen(url){ return !!url && /\.(jpg|jpeg|png|gif|webp)(\?.*)?$/i.test(url); }
function convertirEnlaceYouTube(url){ 
  if(!url) return null;
  let m = url.match(/youtube\.com\/embed\/([a-zA-Z0-9_-]+)/i);
  if(m) return `https://www.youtube.com/embed/${m[1]}`;
  m = url.match(/[?&]v=([a-zA-Z0-9_-]{11})/i);
  if(m) return `https://www.youtube.com/embed/${m[1]}`;
  m = url.match(/youtu\.be\/([a-zA-Z0-9_-]{11})/i);
  if(m) return `https://www.youtube.com/embed/${m[1]}`;
  return null;
}
function convertirSpotifyEnEmbed(url){
  if(!url) return null;
  url = url.split("?")[0].replace("/intl-es","");
  const match = url.match(/open\.spotify\.com\/(track|album|playlist)\/([a-zA-Z0-9]+)/);
  if(match) return `https://open.spotify.com/embed/${match[1]}/${match[2]}`;
  return url.includes("embed")?url:null;
}

async function cargarPublicaciones(){
  const cont = document.getElementById("lista-publicaciones");
  cont.innerHTML = "<p class='text-center text-gray-400'>Cargando publicaciones...</p>";
  try{
    const resp = await fetch(URL_SHEET);
    if(!resp.ok) throw new Error("No se pudo acceder a la hoja");
    const csvText = await resp.text();
    const data = Papa.parse(csvText,{header:true,skipEmptyLines:true}).data;
    cont.innerHTML = "";
    if(!data || data.length===0){ cont.innerHTML="<p class='text-center text-gray-400'>No hay publicaciones.</p>"; return; }
    data.reverse().forEach(raw=>{
      const row={};
      Object.keys(raw).forEach(k=>row[k.trim().toLowerCase()]=String(raw[k]||"").trim());
      if(!row.titulo && !row.contenido) return;
      const card = document.createElement("div");
      card.className="cursor-pointer bg-white rounded-2xl shadow overflow-hidden border border-gray-200 p-4 hover:shadow-lg transition";

      const h3 = document.createElement("h3"); h3.textContent = row.titulo||"Sin tÃ­tulo"; h3.className="font-semibold mb-1 text-indigo-600"; card.appendChild(h3);
      if(row.contenido){ const p=document.createElement("p"); p.textContent=row.contenido; p.className="text-sm text-gray-600 mb-2"; card.appendChild(p); }

      if(row.imagen){ 
        const v = convertirEnlaceYouTube(row.imagen);
        if(v) card.innerHTML+=`<iframe class="w-full h-52 rounded-lg mb-2" src="${v}" frameborder="0" allowfullscreen></iframe>`;
        else if(esImagen(row.imagen)){ const img=document.createElement("img"); img.src=row.imagen; img.className="w-full h-48 object-cover rounded-lg mb-2"; card.appendChild(img);}
      }

      if(row.video){ const vid=convertirEnlaceYouTube(row.video); if(vid){ const f=document.createElement("div"); f.innerHTML=`<iframe class="w-full h-52 rounded-lg mb-2" src="${vid}" frameborder="0" allowfullscreen></iframe>`; card.appendChild(f); } }
      if(row.spotify){ const sp = convertirSpotifyEnEmbed(row.spotify); if(sp){ const d=document.createElement("div"); d.innerHTML=`<iframe style="border-radius:12px" src="${sp}" width="100%" height="152" frameborder="0" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"></iframe>`; card.appendChild(d); } }

      const shareBtn = document.createElement("button");
      shareBtn.textContent="ðŸ“¤ Compartir WhatsApp";
      shareBtn.className="mt-3 px-3 py-1 bg-green-500 text-white rounded-lg hover:bg-green-600 text-sm w-full";
      shareBtn.addEventListener("click",()=>{ let msg=`*${row.titulo}*\n${row.contenido||''}\n`; if(row.imagen) msg+=`Imagen: ${row.imagen}\n`; if(row.video) msg+=`Video: ${row.video}\n`; if(row.spotify) msg+=`Spotify: ${row.spotify}\n`; msg+=`\n_Compartido desde SoyIBA_`; window.open("https://api.whatsapp.com/send?text="+encodeURIComponent(msg),"_blank"); });
      card.appendChild(shareBtn);

      cont.appendChild(card);
    });
  }catch(e){ cont.innerHTML="<p class='text-center text-red-500'>Error al cargar publicaciones.</p>"; console.error(e);}
}

document.addEventListener("DOMContentLoaded", cargarPublicaciones);
</script>
</body>
</html>
